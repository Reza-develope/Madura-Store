<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Madura Store — Resource Tracker (Fix Input)</title>
  <style>
    body{font-family:Arial, sans-serif; background:#0f1724; color:#e6eef6; margin:0; padding:20px;}
    h1{margin:0 0 20px 0;}
    table{width:100%; border-collapse:collapse; margin-top:20px;}
    th,td{padding:8px; border-bottom:1px solid rgba(255,255,255,0.1);}
    th{color:#9aa4b2; text-align:left;}
    input{width:100px; padding:6px; border-radius:6px; border:1px solid rgba(255,255,255,0.2); background:transparent; color:#fff;}
    .totals{margin:20px 0; display:flex; gap:12px; flex-wrap:wrap;}
    .card{background:#182132; padding:12px 16px; border-radius:8px;}
    .value{font-weight:bold; font-size:16px;}
    .percent{font-size:12px; color:#9aa4b2;}
    button{margin:5px; padding:8px 12px; border:none; border-radius:6px; font-weight:bold; cursor:pointer;}
    .add{background:#1ea7ff; color:#022;}
    .reset{background:#ff6b6b; color:#022;}
    .prices{margin:10px 0; display:flex; gap:12px; flex-wrap:wrap;}
    .price-card{background:#1a2a3a; padding:10px 14px; border-radius:6px; border-left:3px solid #1ea7ff;}
  </style>
</head>
<body>
  <h1>Madura Store — Resource Tracker</h1>

  <div class="totals">
    <div class="card">Food: <span id="totalFood" class="value">0</span></div>
    <div class="card">Wood: <span id="totalWood" class="value">0</span></div>
    <div class="card">Stone: <span id="totalStone" class="value">0</span></div>
    <div class="card">Gold: <span id="totalGold" class="value">0</span></div>
    <div class="card">All: <span id="totalAll" class="value">0</span></div>
  </div>

  <!-- Baris baru untuk menampilkan harga -->
  <div class="prices">
    <div class="price-card">Harga Food: <span id="priceFood" class="value">Rp 0</span></div>
    <div class="price-card">Harga Wood: <span id="priceWood" class="value">Rp 0</span></div>
    <div class="price-card">Harga Stone: <span id="priceStone" class="value">Rp 0</span></div>
    <div class="price-card">Harga Gold: <span id="priceGold" class="value">Rp 0</span></div>
    <div class="price-card">Total Harga: <span id="priceAll" class="value">Rp 0</span></div>
  </div>

  <button class="add" id="addMember">+ Tambah Anggota</button>
  <button class="reset" id="resetData">Reset Semua</button>

  <table>
    <thead>
      <tr>
        <th>Nama</th>
        <th>Food</th>
        <th>Wood</th>
        <th>Stone</th>
        <th>Gold</th>
        <th>Total</th>
        <th>% Kontribusi</th>
      </tr>
    </thead>
    <tbody id="membersBody"></tbody>
  </table>

  <script>
    const storageKey = 'ms_resource_v2';
    let members = load() || [];

    // Harga per unit resource
    const PRICES = {
      food: 700,
      wood: 700,
      stone: 800,
      gold: 1000
    };

    const body = document.getElementById('membersBody');

    function createMember(name="Anggota"){
      return {id:Date.now()+Math.random(), name, food:0, wood:0, stone:0, gold:0};
    }

    function save(){ localStorage.setItem(storageKey, JSON.stringify(members)); }
    function load(){ try{return JSON.parse(localStorage.getItem(storageKey))}catch{return null} }

    function formatRupiah(amount) {
      return 'Rp ' + amount.toLocaleString('id-ID');
    }

    function updateTotals(){
      let tf=0, tw=0, ts=0, tg=0;
      members.forEach(m=>{
        tf+=m.food; tw+=m.wood; ts+=m.stone; tg+=m.gold;
      });
      const ta = tf+tw+ts+tg;
      
      // Update jumlah resource
      document.getElementById('totalFood').textContent=tf.toLocaleString();
      document.getElementById('totalWood').textContent=tw.toLocaleString();
      document.getElementById('totalStone').textContent=ts.toLocaleString();
      document.getElementById('totalGold').textContent=tg.toLocaleString();
      document.getElementById('totalAll').textContent=ta.toLocaleString();
      
      // Update harga resource
      document.getElementById('priceFood').textContent=formatRupiah(tf * PRICES.food);
      document.getElementById('priceWood').textContent=formatRupiah(tw * PRICES.wood);
      document.getElementById('priceStone').textContent=formatRupiah(ts * PRICES.stone);
      document.getElementById('priceGold').textContent=formatRupiah(tg * PRICES.gold);
      document.getElementById('priceAll').textContent=formatRupiah(
        (tf * PRICES.food) + (tw * PRICES.wood) + (ts * PRICES.stone) + (tg * PRICES.gold)
      );
      
      return {tf,tw,ts,tg,ta};
    }

    function render(){
      body.innerHTML="";
      const totals = updateTotals();
      members.forEach(m=>{
        const tr=document.createElement('tr');

        // nama
        const tdName=document.createElement('td');
        const inpName=document.createElement('input');
        inpName.value=m.name;
        inpName.style.width="120px";
        inpName.addEventListener('blur',()=>{m.name=inpName.value; save();});
        tdName.appendChild(inpName);
        tr.appendChild(tdName);

        // helper num input
        function makeNumCell(key){
          const td=document.createElement('td');
          const inp=document.createElement('input');
          inp.type="number"; inp.value=m[key]; inp.min=0;
          inp.addEventListener('blur',()=>{m[key]=parseInt(inp.value)||0; save(); render();});
          inp.addEventListener('keydown',(e)=>{if(e.key==="Enter") inp.blur();});
          td.appendChild(inp);
          return td;
        }

        tr.appendChild(makeNumCell('food'));
        tr.appendChild(makeNumCell('wood'));
        tr.appendChild(makeNumCell('stone'));
        tr.appendChild(makeNumCell('gold'));

        // total per member
        const total=m.food+m.wood+m.stone+m.gold;
        const tdTot=document.createElement('td');
        tdTot.textContent=total.toLocaleString();
        tr.appendChild(tdTot);

        // persen kontribusi
        const tdPerc=document.createElement('td');
        const perc=totals.ta?((total/totals.ta)*100).toFixed(2):0;
        tdPerc.textContent=perc+"%";
        tr.appendChild(tdPerc);

        body.appendChild(tr);
      });
    }

    document.getElementById('addMember').onclick=()=>{
      if(members.length>=20) return alert("Maksimal 20 anggota!");
      members.push(createMember("Anggota "+(members.length+1)));
      save(); render();
    }

    document.getElementById('resetData').onclick=()=>{
      if(confirm("Reset semua data?")){members=[]; save(); render();}
    }

    if(members.length===0){ members=[createMember("Admin"), createMember("Anggota 1")]; save(); }
    render();
  </script>
</body>
</html>
